import srt
import os
from normal_translate import *

def translate_srt(source_srt_file,folder_to_send):
    subs = list(srt.parse(open(source_srt_file, 'r', encoding='utf-8').read()))
    content_list = []
    
    for sub in subs:
       content_list.append(sub.content)
    print("translating")
    translated_content_list = translate_list(content_list)
    #translated_content_list = get_gemini_translation(content_list,"Japanese","English")
    #translated_content_list = ['<paragraph>Oh, everyone!', 'Oh, I see the place. What, this camera! You notice it so fast! Yes, yes, ', 'I didn’t know it at first. I didn’t know it. Sorry, I didn’t know it. I didn’t know it. Of course, there is a Tatower game. That’s right. Oh, the teacher’s department.', 'This, that, the drive recorder is often heard by everyone. It’s different, I think it’s different. I think it’s different.', 'Well, for the time being, if there is something, if there is a tweet or something, it’s terrible, so, well, but, that’s it, that’s right, that’s right, let’s do it, let’s do it, let’s go, let’s go, go', 'Are you hungry? Belly! I’m a little hungry! Really! Let’s go eat! Yes! Yes! Yes! Hikari-chan, what do you really like? I like shrimp! Shrimp! Shrimp! Where there are shrimps! Let’s go?', 'I want to go to a place with a station.', 'I wonder where it is. Where is it? Shrimp. Let’s go wherever there is anything. I like anything with shrimp. Such as shrimp tempura and raw shrimp. Raw is also good, but I prefer it cooked. Is that so?', 'It’s also kind to the owner, and it won’t hit you. No, but it’s good, driving. Driving is good. It’s fun.', 'It’s also cool. Oh, if you walk, it’s warm, you can hear English. Yes, it’s cool. Which house did you start to hate, you said? Now...', 'I wonder how long it’s been, I said it was about three years, three years, about a year ago.', 'I haven’t had a boyfriend for a long time. It would be strange if I had a boyfriend. It’s already over. But, the shop where I don’t get picked up, the person working in the cafe.', 'Other customers too. I was caught by an old man the other day. Hey, is it Chihiro-san? Yes, that, ', 'Suddenly? Yes, something, I put it down, and when I put it down, it was done, huh? Huh? I said. I was surprised. Huh? Huh? Like this. Yes, like this. Like this. It’s warm.', 'Yes', 'Be careful with your hands. But, not to mention your hands, what should you do if you come to such a place? Yes, then! Can you do it?', 'Arrived. Arrived. I’m hungry. I’m hungry. I’ll grow up and get everything. There are shrimps, right, shrimps. There are shrimps. There are various white shrimps.', 'Landing! Landing! Yeah! Epita! Epi, Epi, ', 'Huh? There were no shrimps? No, what’s that! ', 'Is this fried chicken? Grated! Grated radish fried chicken!', 'Delicious!', 'Huh? Make, make, ', 'Rather than being good at it, but, recently, I’ve been looking at recipes or something, yes, yes, yes, yes, I’ve been looking at them on my smartphone or something, and I’ve been making elaborate ones that take time.', 'I made gratin recently. I put shrimp, squid, and potatoes in it.', 'Potatoes go well with shrimp and shrimp. It was delicious. Kingi and potatoes were delicious. They go well together.', 'Very much, after all, in the current case, it’s not like cooking is delicious. Yes, maybe, but it’s okay if you can’t do it.', 'You’d better worry about it. But, I can’t do that much. I’ll fail. ', 'Maybe it’s better to fail occasionally in the opposite way.', 'Girls often make it together at home. It seems fun, if everyone says goodbye. I can’t do it at all, so I buy food. It’s better to respect those who can do it.', 'Make it next time. That’s good.', 'It’s warm, so please.', 'Yes, yes. Huh, really? Yes.', 'It can be written. What is the morning glory. What is the face. This is delicious. Try it. I want to eat it. It’s soft.', 'Delicious! Calories are the same, so don’t hold back, go from 450 kilometers and come back only when the prefecture comes back', 'I get delicious, this is melted', 'Melted. It melts. Oh my, I’m impressed. Hey, a bite. Let me eat it. Wait a minute, I’ll cut it. Delicious. Delicious. Oh, wait, I can’t cut it now.', 'Can you wait a minute? Yes. Don’t grind your teeth, this. Out.', 'Delicious delicious right under the weather delicious refreshing because it was hot just right', 'When he did that, he was gone for about half a year to a year, but in fact, he,', 'Hey, what about dreams, or that over there, let’s try it. Before, hey, that, the chime, I did it at Calisarkus or something. What did you usually do, this.', 'Let’s do it ourselves. Gaia, Gaia, ', 'By myself, alone, a little, I play with it, I do it, maybe, no, that’s it, I bought something like a toy, ', 'Hmm, something scary, scary, or interested, but I haven’t been to the place where I said it. That female comedian. She’s a woman.', 'Are you interested in toys? I brought a small church. Try it for a while. It’s in the car.', 'Hey.', 'It’s embarrassing. No, you have to try it. No, no, if you don’t like it, you have to try it. No, I won’t do it anymore.', 'No, if you say stop. Hey! It seems impossible. No, no, ', 'Just a little bit. Eat quickly, eat a lot. I’m looking forward to it. I hope you’ll be happy. That’s right.', 'What’s up, I feel a little excited.', 'It was delicious. Oh, I ate it. I’m full. What did you think of the dessert? Yes, I’m a little on a diet! You’re not thin at all! ', 'I’m quite careful. Just a little, just a little. What about exercise? I do it, a little. What are you doing? Sit-ups! Sit-ups! Wow, cute! I’m doing it!', 'I’m drinking. Oh, no. Oh, this is the next. This. Toy. So, I did this.', 'Infrared. Infrared. Yes. You can turn it on from a distance. There is something called Tobikko. Wow.', 'It looks cute. Cute pink. It’s cute. I put it in the bread maker, ', 'Will it? I think it feels good. Shall we try it? Wait a minute, then, let’s put it in! Let’s put it in! Wait a minute! I’m looking forward to it!', 'Entered. It’s in. That’s right, if you can see it. It looks like an arcade. It’s in.', 'Wait a minute, oh, what should I do. I’m nervous, this. Oh my, oh my. I’m turning on the switch. The switch is on.', 'Wow, it’s coming quite a lot, this. Blue and dinosaurs.', 'It’s quite strong. I didn’t think it was this strong. It’s quite strong. I’m laughing.', 'Oh, it’s quite strong. It’s quite strong, isn’t it? It’s coming, this. It’s coming quite a lot. Buzzing.', 'The sound and face are like this. Well, quite. The sound is quite loud. It feels good.', 'I say, “Ooh-hoo-hoo.” I say, “Ooh-hoo-hoo.” I say, “Ooh-hoo-hoo.” Then let’s just keep swinging it like this. Just keep going like this? Just keep going like this? Just keep going like this?', 'Wait a minute, just like this? It feels good. Just like this! Get pumped up!', 'This comes often. This comes, but it’s amazing, in Araba, it’s always empty. Is that so? Weird, weird, ', 'I’ve never done it with Gria. Oh, it’s not Gria. I’ll teach you. What? Yes, it’s Gria. I’ll teach you. Before teaching... I brought it over there. Be careful, bang, bang.', 'It’s moving. It’s moving. It’s moving. Okay, restart, off. Off, off, okay, again,']
    print(len(translated_content_list))
    i = 0
    for sub in subs:
        sub.content = translated_content_list[i]
        i += 1

    base_name = os.path.basename(source_srt_file)
    new_name = os.path.splitext(base_name)[0] + '.en.srt'
    target_path = os.path.join(folder_to_send,new_name)

    with open(target_path, 'w', encoding='utf-8') as f:
        f.write(srt.compose(subs))
        return target_path